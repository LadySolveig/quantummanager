(function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define([],b):a.LazyLoad=b(a)})("undefined"==typeof global?this.window||this.global:global,function(a){"use strict";function b(a,b){this.settings=d(c,b||{}),this.images=a||document.querySelectorAll(this.settings.selector),this.observer=null,this.init()}"function"==typeof define&&define.amd&&(a=window);const c={src:"data-src",srcset:"data-srcset",selector:".lazyload",root:null,rootMargin:"0px",threshold:0},d=function(){let a={},b=!1,c=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);for(let f,g=function(c){for(let e in c)Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=b&&"[object Object]"===Object.prototype.toString.call(c[e])?d(!0,a[e],c[e]):c[e])};c<e;c++)f=arguments[c],g(f);return a};if(b.prototype={turn_execute_time:0,turn_execute:null,turns_list:[],turns_thread:0,turns_thread_max:2,init:function(){if(!a.IntersectionObserver)return void this.loadImages();let b=this,c={root:this.settings.root,rootMargin:this.settings.rootMargin,threshold:[this.settings.threshold]};this.observer=new IntersectionObserver(function(a){Array.prototype.forEach.call(a,function(a){a.isIntersecting&&(b.observer.unobserve(a.target),b.addTurn(function(c){let d=a.target.getAttribute(b.settings.src);"img"===a.target.tagName.toLowerCase()&&d&&(a.target.src=d,a.target.onload=function(){c()},a.target.error=function(){c()})}))})},c),Array.prototype.forEach.call(this.images,function(a){b.observer.observe(a)})},changeImages(a){this.images=a},loadAndDestroy:function(){this.settings&&(this.loadImages(),this.destroy())},loadImages:function(){if(!this.settings)return;let a=this;Array.prototype.forEach.call(this.images,function(b){a.addTurn(function(c){let d=b.getAttribute(a.settings.src);"img"===b.tagName.toLowerCase()&&d&&(b.src=d,b.onload=function(){c()},b.error=function(){c()})})})},destroy:function(){this.settings&&(this.observer.disconnect(),this.settings=null)},clearTurn:function(){let a=this;a.turns_list=[],a.turns_thread=0,clearInterval(a.turn_execute),a.turn_execute=null,a.turn_execute_time=0},addTurn:function(a){let b=this;b.turns_list.push(a),null===b.turn_execute&&0<b.turns_list.length&&(b.turn_execute_time=0,b.turn_execute=setInterval(function(){if(0===b.turns_list.length&&5e3<=b.turn_execute_time)return void b.clearTurn();if(b.turns_thread>=b.turns_thread_max)return;let a;a=30<b.turns_list.length?b.turns_list.pop():b.turns_list.shift(),"function"==typeof a&&(a(function(){b.turns_thread--,0>b.turns_thread&&(b.turns_thread=0)}),b.turns_thread++),b.turn_execute_time+=100},100))}},a.lazyload=function(a,c){return new b(a,c)},a.jQuery){const c=a.jQuery;c.fn.lazyload=function(a){return a=a||{},a.attribute=a.attribute||"data-src",new b(c.makeArray(this),a),this}}return b});